import { SpawnOptions, spawnSync } from "node:child_process";
import { Service } from "typedi";

@Service()
export class Powershell {
  public run(args: string[], options: SpawnOptions = {}): Promise<string> {
    return new Promise((resolve, reject) => {
      const child = spawnSync("powershell.exe", args, {
        shell: true,
        stdio: ["pipe"],
        windowsHide: false,
        ...options,
      });

      if (child.error) {
        reject(child.error);
        return;
      }

      resolve(child.stdout.toString());
    });
  }
}
