import { createMock } from "@golevelup/ts-jest";
import { Powershell } from "../../../utils/powershell";
import { ServicesScanner } from "../services.scranner";

describe("Scanners", () => {
  describe("ServicesScanner", () => {
    let service: ServicesScanner;
    const shell = createMock<Powershell>();

    beforeEach(() => {
      service = new ServicesScanner(shell);
    });

    it("Should parse line", async () => {
      jest.spyOn(shell, "run").mockResolvedValueOnce(`DisplayName : Capability Access Manager Service
      State       : Running
      PathName    : C:\\WINDOWS\\system32\\svchost.exe -k appmodel -p
      
      DisplayName : Connected Devices Platform Service
      State       : Running
      PathName    : C:\\WINDOWS\\system32\\svchost.exe -k LocalService -p
                    adsasdasdasd
      
      DisplayName : Certificate Propagation
      State       : Stopped
      PathName    : C:\\WINDOWS\\system32\\svchost.exe -k netsvcs
`);
      const result = await service.listExecutables();
      expect(result).toBeDefined();
    });
  });
});
