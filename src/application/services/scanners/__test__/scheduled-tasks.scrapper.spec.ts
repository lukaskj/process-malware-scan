import { Powershell } from "../../../utils/powershell";
import { ScheduledTasksScanner } from "../scheduled-tasks.scanner";
import { FILEPATHS, VALID_TASKS_LIST } from "./factories/scheduled-tasks.factory";

describe("Scanners", () => {
  describe("ScheduledTasksScanner", () => {
    it("should return a valid executable array", async () => {
      // given
      const powershell = new Powershell();
      jest.spyOn(powershell, "run").mockResolvedValue(VALID_TASKS_LIST);
      const scanner = new ScheduledTasksScanner(powershell);

      // when
      const result = await scanner.listExecutables();

      // then
      expect(powershell.run).toHaveBeenCalled();
      expect(result).toHaveLength(3);
      expect(result).toEqual(
        expect.arrayContaining([
          expect.objectContaining({
            path: FILEPATHS[0],
          }),
          expect.objectContaining({
            path: FILEPATHS[1],
          }),
          expect.objectContaining({
            path: FILEPATHS[2],
          }),
        ]),
      );
    });
  });
});
