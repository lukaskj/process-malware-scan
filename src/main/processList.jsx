import React from 'react'


const _KEY_ = "__VTP"

class ProcessList extends React.Component {
   constructor(props) {
      super(props)
      this.state = { list: [] }
      this.refresh = this.refresh.bind(this)
   }

   getCurrentList() {
      return JSON.parse(localStorage.getItem(_KEY_) || '[]')
   }

   setCurrentList(list) {
      localStorage.setItem(_KEY_, JSON.stringify(list))
   }

   refresh() {
      let currentList = this.getCurrentList().map(p => { p.running = false; return p; })
      window.getProcessList().then(list => {
         for (let p of list) {
            if (!currentList.find(e => e.hash == p.hash)) {
               p.running = true
               currentList.push(p)
            }
         }

         for (let p of currentList) {
            p.running = !!list.find(e => e.hash == p.hash)
         }
         this.setCurrentList(currentList)
         this.setState({ list: currentList })
         console.log(currentList)
      })
   }

   componentWillMount() {
      // this.setCurrentList([])
      this.refresh()
   }

   render() {
      return (
         <div>
            <ul>
               {this.state.list.map(p => <li key={p.hash}>{p.filename} - {p.running ? 'true' : 'false'}</li>)}
            </ul>
         </div>
      )
   }
}

export default ProcessList