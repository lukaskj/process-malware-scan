import React from 'react'


const _KEY_ = "__VTP"

class ProcessList extends React.Component {
   constructor(props) {
      super(props)
      this.state = { list: [] }
      this.refresh = this.refresh.bind(this)
   }

   getCurrentList() {
      return JSON.parse(localStorage.getItem(_KEY_) || '[]')
   }

   setCurrentList(list) {
      localStorage.setItem(_KEY_, JSON.stringify(list))
   }

   refresh() {
      let currentList = this.getCurrentList().map(p => { p.running = false; return p; })
      // window.getProcessList().then(list => {
      //    for (let p of list) {
      //       if (!currentList.find(e => e.hash == p.hash)) {
      //          p.running = true
      //          currentList.push(p)
      //       }
      //    }

      //    for (let p of currentList) {
      //       p.running = !!list.find(e => e.hash == p.hash)
      //    }
      //    this.setCurrentList(currentList)
      //    this.setState({ list: currentList })
      // })
      this.setCurrentList(currentList)
      this.setState({ list: currentList })
   }

   componentWillMount() {
      // this.setCurrentList([])
      this.refresh()
   }

   render() {
      return (
         <table className="table table-bordered">
            <thead>
               <tr>
                  <th scope="col">Process</th>
                  <th scope="col">Running</th>
                  <th scope="col">Actions</th>
               </tr>
            </thead>
            <tbody>
               {this.state.list.map(p => (
                  <tr key={p.hash}>
                     <td scope="col" key={p.hash}>{p.filename}</td> 
                     <td style={{fontSize: '2em', textAlign: 'center'}}><i className={`fa ${!p.running ? 'fa-check-circle' : 'fa-times-circle'}`}></i></td>
                     <td style={{}}><button className="btn btn-primary">Send</button></td>
                  </tr>
               ))}
            </tbody>
         </table>
      )
   }
}


// class TableMultiline extends React.Component {
//    constructor(props) {
//       super(props)
//    }

//    render() {
//       return {

//       }
//    }
// }

export default ProcessList